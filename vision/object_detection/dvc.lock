schema: '2.0'
stages:
  download_model:
    cmd:
    - "docker run -it \\\n  -v \"$(pwd)\"/models/weights:/usr/src/app/models/weights\
      \ \\\n  ${YOLOV5_IMAGE} \\\n  python3 -c \"from utils.downloads import attempt_download;\
      \ attempt_download(f'models/weights/yolov5s.pt')\"\n"
    params:
      params.yaml:
        train:
          weights_dir: models/weights
          weights: yolov5s.pt
          data: data/coco128.yaml
          hyp: data/hyps/hyp.scratch-low.yaml
          epochs: 3
          batch_size: 16
          img_size: 32
          optimizer: Adam
          workers: 8
          project: runs/train
          entity:
          label_smoothing: 0.0
          bbox_interval: -1
          save_period: -1
          artifact_alias: latest
          yolo_flags: --exist-ok
    outs:
    - path: models/weights/yolov5s.pt
      md5: 523cc152dea05959e1a07f04fb43ebcf
      size: 14808437
  train:
    cmd: "docker run -it -v \"$(pwd)\"/datasets:/usr/src/datasets -v \"$(pwd)\"/models/weights:/usr/src/app/models/weights\
      \  -v \"$(pwd)\"/runs:/usr/src/app/runs  openbot-vision-object-detection:latest\
      \  python3 train.py  --weights models/weights/yolov5s.pt  --data data/coco128.yaml\
      \  --hyp data/hyps/hyp.scratch-low.yaml  --epochs 3  --batch-size 16  --img-size\
      \ 32  --optimizer Adam  --workers 8  --project runs/train  --name exp  --label-smoothing\
      \ 0.0  --save-period -1  --entity None  --bbox_interval -1  --artifact_alias\
      \ latest --exist-ok\n  "
    deps:
    - path: models/weights/yolov5s.pt
      md5: 523cc152dea05959e1a07f04fb43ebcf
      size: 14808437
    params:
      params.yaml:
        train:
          weights_dir: models/weights
          weights: yolov5s.pt
          data: data/coco128.yaml
          hyp: data/hyps/hyp.scratch-low.yaml
          epochs: 3
          batch_size: 16
          img_size: 32
          optimizer: Adam
          workers: 8
          project: runs/train
          entity:
          label_smoothing: 0.0
          bbox_interval: -1
          save_period: -1
          artifact_alias: latest
          yolo_flags: --exist-ok
    outs:
    - path: runs/train/exp/F1_curve.png
      md5: bc60e32bb5223cb377428c69fbe6ff70
      size: 93906
    - path: runs/train/exp/PR_curve.png
      md5: 951903eed69ec7ae5e03a272835c5f2d
      size: 74394
    - path: runs/train/exp/P_curve.png
      md5: ae7cf341d9759bf8fed0c1cdd437bf31
      size: 153765
    - path: runs/train/exp/R_curve.png
      md5: af2f06a06930fa1fc316641c9f31931f
      size: 99009
    - path: runs/train/exp/confusion_matrix.png
      md5: f68680cb912de8e6b3072a7f50f0fe53
      size: 553826
    - path: runs/train/exp/hyp.yaml
      md5: 0b99b67c046abfdcc69005b3d8db9e83
      size: 373
    - path: runs/train/exp/labels.jpg
      md5: dcd2672956db13bacd2d56ea18a74186
      size: 245726
    - path: runs/train/exp/labels_correlogram.jpg
      md5: aaf6ec90cd751d5f88fad529d0ca5147
      size: 211515
    - path: runs/train/exp/results.csv
      md5: 2f70602bf07f85480aa10ff96f9e57c6
      size: 1176
    - path: runs/train/exp/results.png
      md5: 0848455b9b8550f3538ca898ecafa954
      size: 291783
    - path: runs/train/exp/weights/best.pt
      md5: 729a97c766cb5440d061c6abd588c9e3
      size: 14641277
    - path: runs/train/exp/weights/last.pt
      md5: c6e628fc895392572b1e6eafdbf98c8d
      size: 14641277
  val:
    cmd: docker run -it --ipc=host -v "$(pwd)"/datasets:/usr/src/datasets -v "$(pwd)"/runs:/usr/src/app/runs
      openbot-vision-object-detection:latest python3 val.py --data data/coco128.yaml
      --weights runs/train/exp/weights/best.pt --batch-size  32 --img-size 640 --conf-thres
      0.001 --iou-thres 0.6 --max-det 50 --task val --project runs/val --name exp
      --verbose --save-conf --save-json --exist-ok
    deps:
    - path: runs/train/exp/weights/best.pt
      md5: 729a97c766cb5440d061c6abd588c9e3
      size: 14641277
    params:
      params.yaml:
        val:
          batch_size: 32
          img_size: 640
          conf_thres: 0.001
          iou_thres: 0.6
          max_det: 50
          workers: 8
          project: runs/val
          yolo_flags: --verbose --save-conf --save-json --exist-ok
    outs:
    - path: runs/val/exp/F1_curve.png
      md5: bd35ccadfb36587f67eafe343010aa1a
      size: 59486
    - path: runs/val/exp/PR_curve.png
      md5: e261d81018537b488d15a42a7fdee3e3
      size: 64833
    - path: runs/val/exp/P_curve.png
      md5: c6a0ee214f7a4215a3cb275f4cf1e96f
      size: 85252
    - path: runs/val/exp/R_curve.png
      md5: 962dc460a85e18ec0c2a2961861ed63f
      size: 61054
    - path: runs/val/exp/best_predictions.json
      md5: 843c75af18f5e7cdaa94ba2b9b1e880f
      size: 43870
    - path: runs/val/exp/confusion_matrix.png
      md5: 609767d07c9df46877c024efa2eb0af4
      size: 553395
  exports@2:
    cmd: docker run -it --ipc=host  -v "$(pwd)"/datasets:/usr/src/datasets -v "$(pwd)"/runs:/usr/src/app/runs
      openbot-vision-object-detection:latest python3 export.py  --data data/coco128.yaml
      --weights runs/train/exp/weights/best.pt --img-size 640 --batch-size  1 --opset
      12 --topk-per-class 100 --topk-all 100 --iou-thres 0.45 --conf-thres 0.25 --include
      coreml --verbose
    deps:
    - path: runs/train/exp/weights/best.pt
      md5: 729a97c766cb5440d061c6abd588c9e3
      size: 14641277
    outs:
    - path: runs/train/exp/weights/best.mlmodel
      md5: 46d94515a4bfef80dd869c96d2e0b82f
      size: 29321907
  exports@1:
    cmd: docker run -it --ipc=host  -v "$(pwd)"/datasets:/usr/src/datasets -v "$(pwd)"/runs:/usr/src/app/runs
      openbot-vision-object-detection:latest python3 export.py  --data data/coco128.yaml
      --weights runs/train/exp/weights/best.pt --img-size 640 --batch-size  1 --opset
      12 --topk-per-class 100 --topk-all 100 --iou-thres 0.45 --conf-thres 0.25 --include
      onnx --verbose
    deps:
    - path: runs/train/exp/weights/best.pt
      md5: 729a97c766cb5440d061c6abd588c9e3
      size: 14641277
    outs:
    - path: runs/train/exp/weights/best.onnx
      md5: c90745f520888d601ba50ba3d6769fa6
      size: 29352431
  exports@0:
    cmd: docker run -it --ipc=host  -v "$(pwd)"/datasets:/usr/src/datasets -v "$(pwd)"/runs:/usr/src/app/runs
      openbot-vision-object-detection:latest python3 export.py  --data data/coco128.yaml
      --weights runs/train/exp/weights/best.pt --img-size 640 --batch-size  1 --opset
      12 --topk-per-class 100 --topk-all 100 --iou-thres 0.45 --conf-thres 0.25 --include
      torchscript --verbose
    deps:
    - path: runs/train/exp/weights/best.pt
      md5: 729a97c766cb5440d061c6abd588c9e3
      size: 14641277
    outs:
    - path: runs/train/exp/weights/best.torchscript
      md5: 128f80727d835f488ee76d8164663bb8
      size: 29378005
