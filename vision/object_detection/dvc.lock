schema: '2.0'
stages:
  test:
    cmd: docker run -it --ipc=host  -v "$(pwd)"/datasets:/usr/src/datasets  -v "$(pwd)"/runs:/usr/src/app/runs  $YOLOV5_IMAGE  python3
      val.py --weights yolov5s.pt --exist-ok
  val:
    cmd: docker run -it --ipc=host  -v "$(pwd)"/data_config:/usr/src/app/data_config
      -v "$(pwd)"/datasets:/usr/src/datasets  -v "$(pwd)"/runs:/usr/src/app/runs  $YOLOV5_IMAGE  python3
      val.py --data data/coco128.yaml --weights runs/train/exp/weights/best.pt --batch-size  32
      --img-size 640 --conf-thres 0.001 --iou-thres 0.6 --max-det 50 --task val --verbose  --save-conf  --save-json   --project
      . --name runs/val --exist-ok
    deps:
    - path: runs/train/exp/weights/best.pt
      md5: 2dbf9129979e9dccd0edae05115ceace
      size: 14641277
    params:
      params.yaml:
        val:
          batch_size: 32
          img_size: 640
          conf_thres: 0.001
          iou_thres: 0.6
          max_det: 50
          project: .
          stage_name: runs/val
  download:
    cmd: ./download_dataset.sh coco128
    deps:
    - path: download_dataset.sh
      md5: a609c287622cdd5838996eff5fc04ac2
      size: 253
    params:
      params.yaml:
        data:
          dataset: coco128
          val: data_config/coco128.yaml
    outs:
    - path: ./datasets/coco128
      md5: 01c881881d985711aa5ebb5f5f4e8722.dir
      size: 7003402
      nfiles: 258
  train:
    cmd:
    - "docker run -it \\\n  -v \"$(pwd)\"/datasets:/usr/src/datasets \\\n  -v \"$(pwd)\"\
      /models/weights:/usr/src/app/models/weights \\\n  -v \"$(pwd)\"/runs:/usr/src/app/runs\
      \ \\\n  ${YOLOV5_IMAGE} /bin/bash -c \\\n    \"if [ -f /usr/src/app/models/weights/yolov5s.pt\
      \ ]; then\n      ln -s /usr/src/app/models/weights/yolov5s.pt /usr/src/app\n\
      \    fi;\n\n    python3 train.py \\\n    --weights yolov5s.pt \\\n    --data\
      \ data/coco128.yaml \\\n    --hyp data/hyps/hyp.scratch-low.yaml \\\n    --epochs\
      \ 3 \\\n    --batch-size 16 \\\n    --img-size 32 \\\n    --optimizer Adam \\\
      \n    --workers 8 \\\n    --project runs/train \\\n    --name exp \\\n    --label-smoothing\
      \ 0.0 \\\n    --save-period -1 \\\n    --local_rank -1 \\\n    --entity None\
      \ \\\n    --bbox_interval -1 \\\n    --artifact_alias latest \\\n    --exist-ok\n\
      \n    if [ ! -f /usr/src/app/models/weights/yolov5s.pt ]; then\n      cp /usr/src/app/yolov5s.pt\
      \ /usr/src/app/models/weights/\n    fi;\"\n"
    params:
      params.yaml:
        train:
          weights: yolov5s.pt
          data: data/coco128.yaml
          hyp: data/hyps/hyp.scratch-low.yaml
          epochs: 3
          batch_size: 16
          img_size: 32
          optimizer: Adam
          local_rank: -1
          workers: 8
          project: runs/train
          entity:
          name: exp
          label_smoothing: 0.0
          bbox_interval: -1
          save_period: -1
          artifact_alias: latest
          yolo_flags: --exist-ok
    outs:
    - path: runs/train/exp/weights/best.pt
      md5: 2dbf9129979e9dccd0edae05115ceace
      size: 14641277
    - path: runs/train/exp/weights/last.pt
      md5: 298b6e0dc46c69d9064b5bc0c33f6199
      size: 14641277
