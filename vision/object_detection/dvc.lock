schema: '2.0'
stages:
  test:
    cmd: docker run -it --ipc=host  -v "$(pwd)"/datasets:/usr/src/datasets  -v "$(pwd)"/runs:/usr/src/app/runs  $YOLOV5_IMAGE  python3
      val.py --weights yolov5s.pt --exist-ok
  val:
    cmd: docker run -it --ipc=host  -v "$(pwd)"/data_config:/usr/src/app/data_config
      -v "$(pwd)"/datasets:/usr/src/datasets  -v "$(pwd)"/runs:/usr/src/app/runs  $YOLOV5_IMAGE  python3
      val.py --data data/coco128.yaml --weights yolov5s.pt --batch-size  32 --img-size
      640 --conf-thres 0.001 --iou-thres 0.6 --max-det 50 --task val --verbose  --save-conf  --save-json   --project
      . --name runs/val --exist-ok
    params:
      params.yaml:
        val:
          weights: yolov5s.pt
          batch_size: 32
          img_size: 640
          conf_thres: 0.001
          iou_thres: 0.6
          max_det: 50
          project: .
          stage_name: runs/val
  download:
    cmd: ./download_dataset.sh coco128
    deps:
    - path: download_dataset.sh
      md5: a609c287622cdd5838996eff5fc04ac2
      size: 253
    params:
      params.yaml:
        data:
          dataset: coco128
          val: data_config/coco128.yaml
    outs:
    - path: ./datasets/coco128
      md5: 01c881881d985711aa5ebb5f5f4e8722.dir
      size: 7003402
      nfiles: 258
  train:
    cmd: docker run -it -v "$(pwd)"/datasets:/usr/src/datasets  -v "$(pwd)"/runs:/usr/src/app/runs  ${YOLOV5_IMAGE}  python3
      train.py --weights yolov5s.pt --data data/coco128.yaml --hyp data/hyps/hyp.scratch-low.yaml
      --epochs 4 --batch-size 16 --img-size 32 --evolve 3 --cache disk --optimizer
      Adam --workers 8 --project runs/train --name exp --label-smoothing 0.0 --save-period
      -1 --local_rank -1 --entity None --upload_dataset false --bbox_interval -1 --artifact_alias
      latest --nosave
    params:
      params.yaml:
        train:
          weights: yolov5s.pt
          cfg: ''
          data: data/coco128.yaml
          hyp: data/hyps/hyp.scratch-low.yaml
          epochs: 4
          batch_size: 16
          img_size: 32
          rect: false
          resume: false
          nosave: false
          notest: false
          noautoanchor: false
          evolve: 3
          bucket: ''
          cache: disk
          image_weights: false
          device: ''
          multi_scale: false
          single_cls: false
          optimizer: Adam
          sync_bn: false
          local_rank: -1
          workers: 8
          project: runs/train
          entity:
          name: exp
          exist_ok: false
          quad: false
          cos_lr: false
          label_smoothing: 0.0
          upload_dataset: false
          bbox_interval: -1
          save_period: -1
          artifact_alias: latest
